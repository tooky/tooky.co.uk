<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <title>Steve Tooke - Hands-on With the Cucumber Events API</title>
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Merriweather:300italic,300|Source+Sans+Pro:300|Source+Code+Pro' rel='stylesheet' type='text/css'>
    <link href="/stylesheets/reset.css" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/highlight.css" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/blog.css" rel="stylesheet" type="text/css" />
    <script src="/javascripts/track_outbound_links.js" type="text/javascript"></script>

  </head>
  <body>

  <div id='site-header'>
    <div id="site-header-wrapper">
      <h1>
        <a href="/">
          Steve Tooke
        </a>
      </h1>
      <h2>software development flavoured with agile, bdd, ruby and javascript</h2>
    </div>
  </div>
  <div id='main-wrapper'>
    <div id="main" role="main">
        <article>
    <header>
      <h1>Hands-on With the Cucumber Events API</h1>
      <section class="author">
        <img class="avatar" src="/images/tooky-avatar.jpg">
        <p class="byline">by Steve Tooke</p>
        <time datetime="2015-09-14" itemprop="datePublished">September 14th, 2015</time>
      </section>
    </header>
    <section class="article-body">
      <p><a href="https://cucumber.io/blog/2015/09/11/cucumber-2.1">Cucumber Ruby 2.1</a> introduces the new <a href="http://www.rubydoc.info/gems/cucumber/Cucumber/Events">Events API</a> &mdash; a simple way to find out what&rsquo;s happening while Cucumber runs your features. Events are read-only and simplify the process of writing formatters, and other output tools.</p>

<h2>Can you give me an example?</h2>

<p>As much as we love our console applications, we can get a much richer experience in a web browser. How could we get Cucumber to push information into a nice web UI, without losing the rich information available with the built-in formatters.</p>

<p>Let&rsquo;s build a super-simple example using the Events API that uses a websocket to update a web page while cucumber is running.</p>

<p>There&rsquo;s lots of ways to run a websocket server â€“ a favourite of mine is to use <a href="https://github.com/joewalnes/websocketd"><code>websocketd</code></a> because it&rsquo;s <em>super</em> simple. Give it an executable that reads <code>STDIN</code> and write <code>STDOUT</code> and your done!</p>

<p>For our very simple websocket reporter we are going to use a UNIX <a href="https://en.wikipedia.org/wiki/Named_pipe">named pipe</a> to push information out of our cucumber process. To get these events out onto a websocket we need a very simple shell command that reads from a named pipe and echos back onto <code>STDOUT</code>.</p>

<p><code>subscriber.sh</code></p>
<pre><code class="highlight shell"><span class="c">#!/bin/bash</span>

<span class="nv">fifo_name</span><span class="o">=</span><span class="s2">"events"</span>;

<span class="o">[</span> -p <span class="nv">$fifo_name</span> <span class="o">]</span> <span class="o">||</span> mkfifo <span class="nv">$fifo_name</span>;

<span class="k">while </span><span class="nb">true
</span><span class="k">do
  if </span><span class="nb">read </span>line &lt;<span class="nv">$fifo_name</span>; <span class="k">then
    </span><span class="nb">echo</span> <span class="nv">$line</span>
  <span class="k">fi
done</span>
</code></pre>

<p>Make sure the script is executable with <code>chmod +x subscriber.sh</code>.</p>

<p>When you run it, it will create an <code>events</code> named pipe if one doesn&rsquo;t exist already, then wait until there is data on the pipe for it to read. We can see it in action by putting some data on to the pipe: <code>echo &quot;hello, world&quot; &gt; events</code>.</p>

<h3>Writing Cucumber Events to the pipe</h3>

<p>Let&rsquo;s start by asking cucumber to write messages to the pipe, add the following to <code>features/support/env.rb</code></p>
<pre><code class="highlight ruby"><span class="no">EVENT_PIPE</span> <span class="o">=</span> <span class="s2">"events"</span>
<span class="k">unless</span> <span class="no">File</span><span class="p">.</span><span class="nf">exist?</span><span class="p">(</span><span class="no">EVENT_PIPE</span><span class="p">)</span>
  <span class="sb">`mkfifo </span><span class="si">#{</span><span class="no">EVENT_PIPE</span><span class="si">}</span><span class="sb">`</span>
<span class="k">end</span>

<span class="n">publisher</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="no">EVENT_PIPE</span><span class="p">,</span> <span class="s2">"w+"</span><span class="p">)</span>
<span class="n">publisher</span><span class="p">.</span><span class="nf">sync</span> <span class="o">=</span> <span class="kp">true</span>
<span class="n">publisher</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"started"</span>

<span class="nb">at_exit</span> <span class="p">{</span>
  <span class="n">publisher</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"done"</span>
  <span class="n">publisher</span><span class="p">.</span><span class="nf">close</span>
<span class="p">}</span>
</code></pre>

<p>This should hook up cucumber to write to the same named pipe as <code>subscriber.sh</code> will read from. With <code>subscriber.sh</code> up and running, you should be able to run cucumber and see <code>started</code> and <code>done</code> output to the terminal by <code>subscriber.sh</code>.</p>

<p>For our simple web-browser cucumber reporter we want to show each step that cucumber runs, and it&rsquo;s result. We want cucumber to tell us when it starts to execute, when it starts to run each step, when it finishes a step (and what the result was) and when it&rsquo;s finished executing.</p>

<p>We want to send some formatted JSON that give us some information about the events:</p>
<pre><code class="highlight javascript"><span class="p">{</span>
  <span class="s2">"event"</span><span class="err">:</span> <span class="s2">"event_name"</span><span class="p">,</span>
  <span class="s2">"data"</span><span class="err">:</span> <span class="p">{}</span> <span class="c1">//information about the event</span>
<span class="p">}</span>
</code></pre>

<p>We can modify <code>features/support/env.rb</code> to give us the start and end events:</p>
<pre><code class="highlight ruby"><span class="nb">require</span> <span class="s1">'json'</span>

<span class="no">EVENT_PIPE</span> <span class="o">=</span> <span class="s2">"events"</span>
<span class="k">unless</span> <span class="no">File</span><span class="p">.</span><span class="nf">exist?</span><span class="p">(</span><span class="no">EVENT_PIPE</span><span class="p">)</span>
  <span class="sb">`mkfifo </span><span class="si">#{</span><span class="no">EVENT_PIPE</span><span class="si">}</span><span class="sb">`</span>
<span class="k">end</span>

<span class="n">publisher</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="no">EVENT_PIPE</span><span class="p">,</span> <span class="s2">"w+"</span><span class="p">)</span>
<span class="n">publisher</span><span class="p">.</span><span class="nf">sync</span> <span class="o">=</span> <span class="kp">true</span>
<span class="n">publisher</span><span class="p">.</span><span class="nf">puts</span><span class="p">({</span><span class="ss">event: </span><span class="s2">"started"</span><span class="p">,</span> <span class="ss">data: </span><span class="p">{}}.</span><span class="nf">to_json</span><span class="p">)</span>

<span class="nb">at_exit</span> <span class="p">{</span>
  <span class="n">publisher</span><span class="p">.</span><span class="nf">puts</span><span class="p">({</span><span class="ss">event: </span><span class="s2">"done"</span><span class="p">,</span> <span class="ss">data: </span><span class="p">{}}.</span><span class="nf">to_json</span><span class="p">)</span>
  <span class="n">publisher</span><span class="p">.</span><span class="nf">close</span>
<span class="p">}</span>
</code></pre>

<p>The Cucumber Events API gives us access to what&rsquo;s going on inside Cucumber while it&rsquo;s running our features. We want to know when a step is going to be run, and what happened when it finished. Cucumber provides us the <a href="http://www.rubydoc.info/gems/cucumber/Cucumber/Events/BeforeTestStep"><code>BeforeTestStep</code></a> and <a href="http://www.rubydoc.info/gems/cucumber/Cucumber/Events/AfterTestStep"><code>AfterTestStep</code></a> events. To sign up to hear about these events we can use the cucumber <code>AfterConfiguration</code> hook to get access to the current config, and add handlers for specific events with the <code>on_event</code> method:</p>
<pre><code class="highlight ruby"><span class="no">AfterConfiguration</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">on_event</span> <span class="ss">:before_test_step</span> <span class="k">do</span> <span class="o">|</span><span class="n">event</span><span class="o">|</span>
  <span class="k">end</span>

  <span class="n">config</span><span class="p">.</span><span class="nf">on_event</span> <span class="ss">:after_test_step</span> <span class="k">do</span> <span class="o">|</span><span class="n">event</span><span class="o">|</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>Putting this all together we can modify <code>features/support/env.rb</code> to push these events out onto our named pipe too:</p>
<pre><code class="highlight ruby"><span class="nb">require</span> <span class="s1">'json'</span>

<span class="no">EVENT_PIPE</span> <span class="o">=</span> <span class="s2">"events"</span>
<span class="k">unless</span> <span class="no">File</span><span class="p">.</span><span class="nf">exist?</span><span class="p">(</span><span class="no">EVENT_PIPE</span><span class="p">)</span>
  <span class="sb">`mkfifo </span><span class="si">#{</span><span class="no">EVENT_PIPE</span><span class="si">}</span><span class="sb">`</span>
<span class="k">end</span>

<span class="n">publisher</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="no">EVENT_PIPE</span><span class="p">,</span> <span class="s2">"w+"</span><span class="p">)</span>
<span class="n">publisher</span><span class="p">.</span><span class="nf">sync</span> <span class="o">=</span> <span class="kp">true</span>

<span class="no">AfterConfiguration</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">publisher</span><span class="p">.</span><span class="nf">puts</span><span class="p">({</span><span class="ss">event: </span><span class="s2">"started"</span><span class="p">,</span> <span class="ss">data: </span><span class="p">{}}.</span><span class="nf">to_json</span><span class="p">)</span>

  <span class="n">config</span><span class="p">.</span><span class="nf">on_event</span> <span class="ss">:before_test_step</span> <span class="k">do</span> <span class="o">|</span><span class="n">event</span><span class="o">|</span>
    <span class="n">publisher</span><span class="p">.</span><span class="nf">puts</span><span class="p">(</span>
      <span class="p">{</span>
        <span class="ss">event: </span><span class="s2">"before_test_step"</span><span class="p">,</span>
        <span class="ss">data: </span><span class="p">{}</span>
      <span class="p">}.</span><span class="nf">to_json</span>
    <span class="p">)</span>
  <span class="k">end</span>

  <span class="n">config</span><span class="p">.</span><span class="nf">on_event</span> <span class="ss">:after_test_step</span> <span class="k">do</span> <span class="o">|</span><span class="n">event</span><span class="o">|</span>
    <span class="n">publisher</span><span class="p">.</span><span class="nf">puts</span><span class="p">(</span>
      <span class="p">{</span>
        <span class="ss">event: </span><span class="s2">"after_test_step"</span><span class="p">,</span>
        <span class="ss">data: </span><span class="p">{</span> <span class="ss">result: </span><span class="n">event</span><span class="p">.</span><span class="nf">result</span><span class="p">.</span><span class="nf">to_s</span> <span class="p">}</span>
      <span class="p">}.</span><span class="nf">to_json</span>
    <span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="nb">at_exit</span> <span class="p">{</span>
  <span class="n">publisher</span><span class="p">.</span><span class="nf">puts</span><span class="p">({</span><span class="ss">event: </span><span class="s2">"done"</span><span class="p">,</span> <span class="ss">data: </span><span class="p">{}}.</span><span class="nf">to_json</span><span class="p">)</span>
  <span class="n">publisher</span><span class="p">.</span><span class="nf">close</span>
<span class="p">}</span>
</code></pre>

<p>Now if you run Cucumber, with <code>subscriber.sh</code> up and running you should see something like:</p>
<pre><code class="highlight plaintext">$ ./subscriber.sh
{"event":"started","data":{}}
{"event":"before_test_step","data":{}}
{"event":"after_test_step","data":{"result":"âœ“"}}
{"event":"before_test_step","data":{}}
{"event":"after_test_step","data":{"result":"âœ“"}}
{"event":"before_test_step","data":{}}
{"event":"after_test_step","data":{"result":"âœ“"}}
{"event":"before_test_step","data":{}}
{"event":"after_test_step","data":{"result":"âœ—"}}
{"event":"before_test_step","data":{}}
{"event":"after_test_step","data":{"result":"-"}}
{"event":"done","data":{}}
</code></pre>

<h3>Hooking up a WebSocket</h3>

<p>Great! We&rsquo;ve got Cucumber sending our events. We now want to get these events pushed into a web-page using a websocket.</p>

<p><code>websocketd</code> lets us hook our <code>subscriber.sh</code> command up to a websocket. Let&rsquo;s have a look at what happens using <code>websocketd</code>&rsquo;s <code>devconsole</code> mode:</p>
<pre><code class="highlight plaintext">$ websocketd --port=8080 --devconsole ./subscriber.sh
</code></pre>

<p>Then point your browser to [http://localhost:8080] and you should see:</p>

<p><img alt="websocketd devconsole" src="/images/websocketd-devconsole.png" /></p>

<p>Clicking the little &ldquo;âœ”&rdquo; in the top left will connect the <code>websocketd</code>&rsquo;s dev console to the running socket. Now if you <code>echo</code> some text on to the named pipe, you will see it appear in the console on the web browser. Now running Cucumber again, you should see something like this in the web browser:</p>

<p><img alt="cucumber events appear in websocketd devconsole" src="/images/websocketd-devconsole-cuke.png" /></p>

<h3>WebSocket Cucumber</h3>

<p>Finishing everything up, lets create a simple web-page that uses the websocket to get information from Cucumber as its running. Save this as <code>index.html</code>:</p>
<pre><code class="highlight html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1&gt;</span>Cucumber Runner<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p</span> <span class="na">id=</span><span class="s">"status"</span><span class="nt">&gt;</span>disconnected<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"runner"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;script&gt;</span>
  <span class="c1">// helper function: log message to screen</span>
  <span class="kd">function</span> <span class="nx">stepStarted</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">runner</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"runner"</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">resultNode</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"span"</span><span class="p">);</span>
    <span class="nx">resultNode</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="s2">"*"</span><span class="p">;</span>
    <span class="nx">runner</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">resultNode</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">stepResult</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">resultNode</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"runner"</span><span class="p">).</span><span class="nx">lastElementChild</span><span class="p">;</span>
    <span class="nx">resultNode</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">clearRunner</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'runner'</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">statusWaiting</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'status'</span><span class="p">).</span><span class="nx">textContent</span> <span class="o">=</span> <span class="s2">"waiting"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">statusRunning</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'status'</span><span class="p">).</span><span class="nx">textContent</span> <span class="o">=</span> <span class="s2">"running"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">statusDisconnected</span><span class="p">()</span> <span class="p">{</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'status'</span><span class="p">).</span><span class="nx">textContent</span> <span class="o">=</span> <span class="s2">"disconnected"</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">done</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">statusWaiting</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">CucumberSocket</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="s1">'ws://localhost:8080/'</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">callbacks</span> <span class="o">=</span> <span class="p">{};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">on</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event_name</span><span class="p">,</span> <span class="nx">callback</span><span class="p">){</span>
      <span class="nx">callbacks</span><span class="p">[</span><span class="nx">event_name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">callback</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">dispatch</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event_name</span><span class="p">,</span> <span class="nx">message</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">callback</span> <span class="o">=</span> <span class="nx">callbacks</span><span class="p">[</span><span class="nx">event_name</span><span class="p">];</span>
      <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">callback</span> <span class="o">==</span> <span class="s1">'undefined'</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
      <span class="nx">callback</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">ws</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
      <span class="nx">dispatch</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">event</span><span class="p">,</span> <span class="nx">json</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">ws</span><span class="p">.</span><span class="nx">onclose</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span><span class="nx">dispatch</span><span class="p">(</span><span class="s1">'close'</span><span class="p">,</span><span class="kc">null</span><span class="p">)}</span>
    <span class="nx">ws</span><span class="p">.</span><span class="nx">onopen</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span><span class="nx">dispatch</span><span class="p">(</span><span class="s1">'open'</span><span class="p">,</span><span class="kc">null</span><span class="p">)}</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">cucumber</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CucumberSocket</span><span class="p">();</span>

  <span class="nx">cucumber</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'open'</span><span class="p">,</span> <span class="nx">statusWaiting</span><span class="p">);</span>

  <span class="nx">cucumber</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'close'</span><span class="p">,</span> <span class="nx">statusDisconnected</span><span class="p">);</span>

  <span class="nx">cucumber</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'started'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">statusRunning</span><span class="p">();</span>
      <span class="nx">clearRunner</span><span class="p">();</span>
  <span class="p">});</span>

  <span class="nx">cucumber</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'before_test_step'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">stepStarted</span><span class="p">();</span>
  <span class="p">});</span>

  <span class="nx">cucumber</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'after_test_step'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">stepResult</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">result</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">cucumber</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'done'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">statusWaiting</span><span class="p">();</span>
  <span class="p">})</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>

<p>Using <code>websocketd</code>&rsquo;s static site server we can get our little web page up and running: <code>websocketd --port=8080 --staticdir=. ./subscriber.sh</code> and open <a href="http://localhost:8080">http://localhost:8080</a>. Now running Cucumber should show you progress in the web page!</p>

<p><a href="https://www.youtube.com/watch?v=-pI5WzHfvjw"><img alt="Cucumber Websocket" src="/images/CucumberWebsocket.gif" /></a></p>

<h2>What events are available?</h2>

<p>Cucumber 2 introduced a new model for executing a set of features. Each scenario is now compiled into a suite of Test Cases, each made up of Test Steps. Test Steps include Before and After hooks. Cucumber fires the following 5 events based on that model.</p>

<ul>
<li><a href="http://www.rubydoc.info/gems/cucumber/Cucumber/Events/BeforeTestCase"><code>BeforeTestCase</code></a> â€“ fired before a test case is executed</li>
<li><a href="http://www.rubydoc.info/gems/cucumber/Cucumber/Events/BeforeTestStep"><code>BeforeTestStep</code></a> â€“ fired before a test step is executed</li>
<li><a href="http://www.rubydoc.info/gems/cucumber/Cucumber/Events/StepMatch"><code>StepMatch</code></a> â€“ fired when a step is matched to a definition</li>
<li><a href="http://www.rubydoc.info/gems/cucumber/Cucumber/Events/AfterTestStep"><code>AfterTestStep</code></a> â€“ fired after each test step has been executed</li>
<li><a href="http://www.rubydoc.info/gems/cucumber/Cucumber/Events/AfterTestCase"><code>AfterTestCase</code></a> â€“ fired after a test case has finished executing</li>
</ul>

<h2>What can I use it for?</h2>

<p>The Events API is there for getting information out of Cucumber. It&rsquo;s going to be the best way to write new formatters in future &mdash; the old formatter API will be removed in Cucumber 3.0. If you&rsquo;re looking for a way to contribute to Cucumber then rewriting some of the old <a href="https://github.com/cucumber/cucumber-ruby/tree/master/lib/cucumber/formatter">formatters</a> to use the new events API.</p>

<p>Any questions please come and join us on our <a href="https://gitter.im/cucumber/chat">gitter channel</a> or the <a href="https://groups.google.com/forum/#!forum/cukes">mailing list</a>. All the code for this blog post is <a href="https://github.com/tooky/cucumber-events">available here</a>.</p>

    </section>
  </article>

    </div>

    <aside id="sidebar">
      <ol id="recent-articles">
        <h2>
          Recent Articles
          <a href="/feed.xml" class="feed" title="Subscribe!"><i class="fa fa-rss"></i></a>
        </h2>
          <li><a href="/hands-on-with-cucumber-events-api/">Hands-on With the Cucumber Events API</a> <span>Sep 14</span></li>
          <li><a href="/your-tests-want-you-to-change-your-design/">Your tests want you to change your design</a> <span>Dec 19</span></li>
          <li><a href="/test-first-diamonds/">Test first diamonds</a> <span>Dec  6</span></li>
          <li><a href="/connascence-and-inverting-dependencies/">Connascence and Inverting Dependencies</a> <span>Nov  7</span></li>
          <li><a href="/next-kickstart-academy-podcast-show-with-liz-keogh-and-chris-matts/">Next Kickstart Academy Podcast Show with Liz Keogh and Chris Matts</a> <span>Aug 21</span></li>
      </ol>

      <ul id="tags">
        <h2>Tags</h2>
          <li><a href="/tags/design/">Design</a></a></li>
          <li><a href="/tags/kata/">Kata</a></a></li>
          <li><a href="/tags/tdd/">TDD</a></a></li>
          <li><a href="/tags/apprenticeship/">apprenticeship</a></a></li>
          <li><a href="/tags/atdd/">atdd</a></a></li>
          <li><a href="/tags/bdd/">bdd</a></a></li>
          <li><a href="/tags/bletchley-park/">bletchley park</a></a></li>
          <li><a href="/tags/charlock_holmes/">charlock_holmes</a></a></li>
          <li><a href="/tags/chris-matts/">chris-matts</a></a></li>
          <li><a href="/tags/coderetreat/">coderetreat</a></a></li>
          <li><a href="/tags/connascence/">connascence</a></a></li>
          <li><a href="/tags/corey-haines/">corey-haines</a></a></li>
          <li><a href="/tags/craft/">craft</a></a></li>
          <li><a href="/tags/craftsmanship/">craftsmanship</a></a></li>
          <li><a href="/tags/cucumber/">cucumber</a></a></li>
          <li><a href="/tags/cynefin/">cynefin</a></a></li>
          <li><a href="/tags/deploymnent/">deploymnent</a></a></li>
          <li><a href="/tags/design/">design</a></a></li>
          <li><a href="/tags/dev/">dev</a></a></li>
          <li><a href="/tags/development/">development</a></a></li>
          <li><a href="/tags/eden/">eden</a></a></li>
          <li><a href="/tags/environment/">environment</a></a></li>
          <li><a href="/tags/fitnesse/">fitnesse</a></a></li>
          <li><a href="/tags/git/">git</a></a></li>
          <li><a href="/tags/github/">github</a></a></li>
          <li><a href="/tags/hacks/">hacks</a></a></li>
          <li><a href="/tags/heroku/">heroku</a></a></li>
          <li><a href="/tags/javascript/">javascript</a></a></li>
          <li><a href="/tags/jekyll/">jekyll</a></a></li>
          <li><a href="/tags/kickstartac/">kickstartac</a></a></li>
          <li><a href="/tags/libicu/">libicu</a></a></li>
          <li><a href="/tags/liz-keogh/">liz-keogh</a></a></li>
          <li><a href="/tags/macosx/">macosx</a></a></li>
          <li><a href="/tags/oo/">oo</a></a></li>
          <li><a href="/tags/oop/">oop</a></a></li>
          <li><a href="/tags/pairing/">pairing</a></a></li>
          <li><a href="/tags/podcast/">podcast</a></a></li>
          <li><a href="/tags/practices/">practices</a></a></li>
          <li><a href="/tags/project/">project</a></a></li>
          <li><a href="/tags/retrospective/">retrospective</a></a></li>
          <li><a href="/tags/ruby/">ruby</a></a></li>
          <li><a href="/tags/sandi-metz/">sandi-metz</a></a></li>
          <li><a href="/tags/sinatra/">sinatra</a></a></li>
          <li><a href="/tags/software/">software</a></a></li>
          <li><a href="/tags/solid/">solid</a></a></li>
          <li><a href="/tags/specification-by-example/">specification-by-example</a></a></li>
          <li><a href="/tags/tdd/">tdd</a></a></li>
          <li><a href="/tags/tools/">tools</a></a></li>
          <li><a href="/tags/training/">training</a></a></li>
          <li><a href="/tags/vim/">vim</a></a></li>
          <li><a href="/tags/xp/">xp</a></a></li>
      </ul>

      <div id="bio">
        <img class="avatar" src="/images/tooky-avatar.jpg">
        <h2>Steve Tooke</h2>
        <p>
        I am a programmer &mdash; consultant, trainer and coach &mdash;
        passionate about improving my craft and helping others improve
        theirs. I specialise in helping teams continue to deliver
        valuable software by improving their team practices and
        communication, and keeping their code maintainable.
        </p>
        <p>
        I co-organised Bootstrapd, a non-profit conference for
        bootstrapped startups in Europe. I am the co-founder of the
        Software Craftsmanship UK user group, and the HampshiRB ruby
        user group. I have spoken at the Scottish Ruby
        Conference and have run workshops at the London Software
        Craftsmanship Community. I am a member of the Cucumber core
        team.
        </p>
        <p>
        <a href="http://kickstartacademy.io">Kickstart Academy</a>
        </p>
      </div>
    </aside>
    <footer>
      <div id='site-footer'>
        <p>All content copyright Steve Tooke &copy; 2015 &middot; All rights reserved.</p>
        <p>Find me on <a href="http://twitter.com/tooky">Twitter</a> | <a href="https://plus.google.com/+SteveTooke-Heavies/">Google+</a></a></p>
    </div>
    </footer>
  </div>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-37664795-2', 'tooky.co.uk');
    ga('send', 'pageview');

  </script>
  </body>
</html>
