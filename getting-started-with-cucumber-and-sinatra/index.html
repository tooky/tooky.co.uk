<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <title>Steve Tooke - Getting started with Cucumber and Sinatra</title>
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Merriweather:300italic,300|Source+Sans+Pro:300|Source+Code+Pro' rel='stylesheet' type='text/css'>
    <link href="/stylesheets/reset.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/highlight.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/blog.css" media="screen" rel="stylesheet" type="text/css" />
  </head>
  <body>

  <div id='site-header'>
    <div id="site-header-wrapper">
      <h1>
        <a href="/">
          Steve Tooke
        </a>
      </h1>
      <h2>software development flavoured with agile, bdd, ruby and javascript</h2>
    </div>
  </div>
  <div id='main-wrapper'>
    <div id="main" role="main">
        <article>
    <header>
      <h1>Getting started with Cucumber and Sinatra</h1>
      <section class="author">
        <img class="avatar" src="/images/tooky-avatar.jpg">
        <p class="byline">by Steve Tooke</p>
        <time datetime="2009-02-05" itemprop="datePublished">February 5th, 2009</time>
      </section>
    </header>
    <section class="article-body">
      <p><strong>UPDATE</strong> Sinatra and cucumber integration has changed now, Rob Holland updated the <a href="https://github.com/cucumber/cucumber/wiki/sinatra">wiki</a> to reflect it. There is also a more full featured example on his <a href="http://github.com/robholland/cucumber/commit/0e12d8100ca8541af014abe6a480c53a90b6aebd">branch</a> of cucumber. I&rsquo;ve updated the blog to reflect that.</p>

<p><a href="http://sinatra.github.com">Sinatra</a> is probably the most popular ruby micro web framework at the moment. Its simple dsl for quickly creating web apps, it give you &ldquo;just enough&rdquo; framework to get things done.</p>

<p><a href="http://cukes.info">Cucumber</a> is that latest development from the <a href="http://dannorth.net/introducing-bdd">BDD</a> / <a href="http://rspec.info">RSpec</a> guys. <a href="http://cukes.info">Cucumber</a> lets you describe the behaviour of your software in plain text. These files then serve as automated tests and documentation.</p>

<p>I&rsquo;ve been considering using both of these tools for an upcoming project so I wanted to make sure they worked happily together. A quick google seemed to suggest that some work had been done, but I could find a tutorial for getting up and running. Happily the latest releases of Cucumber (and <a href="http://github.com/brynary/webrat/tree/master">Webrat</a>) have Sinatra support built in so its really very easy!</p>

<p>With cucumber you write your plain text specifications in terms of &lsquo;features&rsquo;, by convention they are in a features directory with the .feature extension. So for our purposes we will start with a very simple feature:</p>
<pre class="highlight plaintext">Feature: view pages

  Scenario: Home page
    Given I am viewing "/"
    Then I should see "Hello, world!
</pre>

<p>To run our feature (and test our code against it) is as simple as <code>cucumber feature/home.feature</code>.</p>

<p><img alt="cucumber pending steps" src="https://dl.dropboxusercontent.com/u/41915/tooky-images/cucumber1.png" /></p>

<p>Cucumber parses the feature and looks for matching step definitions. As we can see in the screenshot we need to implement the steps in our feature so cucumber knows how to run it. Step definitions are implemented in ruby.</p>
<pre class="highlight plaintext">Given /^I am viewing "(.+)"$/ do |url|
  visit(url)
end

Then /^I should see "(.+)"$/ do |text|
  response_body.should =~ Regexp.new(Regexp.escape(text))
end
</pre>

<p>These two simple steps make use of webrat to request the url from our app and check that the response contains the text we&rsquo;re looking for.</p>

<p><img alt="cucumber failing without webrat" src="https://dl.dropboxusercontent.com/u/41915/tooky-images/cucumber2.png" /></p>

<p>The feature is currently failing as a method we have used in our step definition doesn&rsquo;t exist. <code>visit</code> is a method from webrat so we need to configure cucumber&rsquo;s environment to use webrat. Webrat has a <code>SinatraSession</code> specifically for testing sinatra web apps. We will also need to require the RSpec expectations as we are using them to check the response.</p>
<pre class="highlight plaintext">require 'spec/expectations'
require 'webrat'
Webrat.configure do |config|
  config.mode = :sinatra
end

World do
  Webrat::SinatraSession.new
end
</pre>

<p>Running the scenario again, and we see that everything is hooked up properly and the scenario is failing (as expected because we haven&rsquo;t written any code).</p>

<p><img alt="cucumber failing no code" src="https://dl.dropboxusercontent.com/u/41915/tooky-images/cucumber3.png" /></p>

<p>Now we have our failing scenario we can start putting together our web app and make sure we&rsquo;re running with a green light!</p>
<pre class="highlight plaintext">require 'sinatra'

get '/' do
  "Hello, world!"
end
</pre>

<p>Now if we run out scenario again unfortunately it still fails, we need to hook cucumber up to our app.</p>
<pre class="highlight plaintext">require 'spec/expectations'
require 'webrat'
Webrat.configure do |config|
  config.mode = :sinatra
end

World do
  Webrat::SinatraSession.new
end

require File.dirname(__FILE__) + '/../../hello''
</pre>

<p>Finally running cucumber gives us that nice green feeling.</p>

<p><img alt="green cucumber" src="https://dl.dropboxusercontent.com/u/41915/tooky-images/cucumber4.png" /></p>

<p>The only thing left to do is to add a rake file to run our features for us.</p>
<pre class="highlight plaintext">require 'rubygems'
require 'cucumber/rake/task'

Cucumber::Rake::Task.new(:features) do |t|
  t.cucumber_opts = "--format pretty"
end
</pre>

<p><img alt="rake features" src="https://dl.dropboxusercontent.com/u/41915/tooky-images/cucumber5.png" /></p>

<p>All of the code for this getting started guide is available from <a href="http://gist.github.com/58647">gist</a>.</p>

    </section>
  </article>

    </div>

    <aside id="sidebar">
      <ol id="recent-articles">
        <h2>
          Recent Articles
          <a href="/feed.xml" class="feed" title="Subscribe!"><i class="fa fa-rss"></i></a>
        </h2>
        
          <li><a href="/the-cucumber-test-trap/">The Cucumber Test Trap</a> <span>Mar 29</span></li>
        
          <li><a href="/discovering-bdd/">Discovering BDD</a> <span>Dec 11</span></li>
        
          <li><a href="/learning-by-teaching/">Learning by Teaching</a> <span>Nov  6</span></li>
        
          <li><a href="/stop-writing-scenarios-that-test-everything-through-the-view/">Stop Writing Scenarios That Test Everything Through The View</a> <span>Oct 29</span></li>
        
          <li><a href="/this-gherkins-not-for-reading/">This Gherkin's Not For Reading</a> <span>Oct 24</span></li>
        
      </ol>

      <ul id="tags">
        <h2>Tags</h2>
        
          <li><a href="/tags/apprenticeship/">apprenticeship</a></a></li>
        
          <li><a href="/tags/atdd/">atdd</a></a></li>
        
          <li><a href="/tags/bdd/">bdd</a></a></li>
        
          <li><a href="/tags/bletchley-park/">bletchley park</a></a></li>
        
          <li><a href="/tags/coderetreat/">coderetreat</a></a></li>
        
          <li><a href="/tags/craft/">craft</a></a></li>
        
          <li><a href="/tags/craftsmanship/">craftsmanship</a></a></li>
        
          <li><a href="/tags/cucumber/">cucumber</a></a></li>
        
          <li><a href="/tags/development/">development</a></a></li>
        
          <li><a href="/tags/eden/">eden</a></a></li>
        
          <li><a href="/tags/fitnesse/">fitnesse</a></a></li>
        
          <li><a href="/tags/git/">git</a></a></li>
        
          <li><a href="/tags/github/">github</a></a></li>
        
          <li><a href="/tags/hacks/">hacks</a></a></li>
        
          <li><a href="/tags/javascript/">javascript</a></a></li>
        
          <li><a href="/tags/jekyll/">jekyll</a></a></li>
        
          <li><a href="/tags/kickstartac/">kickstartac</a></a></li>
        
          <li><a href="/tags/macosx/">macosx</a></a></li>
        
          <li><a href="/tags/oo/">oo</a></a></li>
        
          <li><a href="/tags/pairing/">pairing</a></a></li>
        
          <li><a href="/tags/practices/">practices</a></a></li>
        
          <li><a href="/tags/project/">project</a></a></li>
        
          <li><a href="/tags/retrospective/">retrospective</a></a></li>
        
          <li><a href="/tags/ruby/">ruby</a></a></li>
        
          <li><a href="/tags/sinatra/">sinatra</a></a></li>
        
          <li><a href="/tags/software/">software</a></a></li>
        
          <li><a href="/tags/solid/">solid</a></a></li>
        
          <li><a href="/tags/specification-by-example/">specification-by-example</a></a></li>
        
          <li><a href="/tags/tdd/">tdd</a></a></li>
        
          <li><a href="/tags/tools/">tools</a></a></li>
        
          <li><a href="/tags/training/">training</a></a></li>
        
          <li><a href="/tags/vim/">vim</a></a></li>
        
          <li><a href="/tags/xp/">xp</a></a></li>
        
      </ul>

      <div id="bio">
        <img class="avatar" src="/images/tooky-avatar.jpg">
        <h2>Steve Tooke</h2>
        <p>
        I am a programmer &mdash; consultant, trainer and coach &mdash;
        passionate about improving my craft and helping others improve
        theirs. I specialise in helping teams continue to deliver
        valuable software by improving their team practices and
        communication, and keeping their code maintainable.
        </p>
        <p>
        I co-organised Bootstrapd, a non-profit conference for
        bootstrapped startups in Europe. I am the co-founder of the
        Software Craftsmanship UK user group, and the HampshiRB ruby
        user group. I have spoken at the Scottish Ruby
        Conference and have run workshops at the London Software
        Craftsmanship Community. I am a member of the Cucumber core
        team.
        </p>
        <p>
        <a href="http://kickstartacademy.io">Kickstart Academy</a>
        </p>
      </div>
    </aside>
    <footer>
      <div id='site-footer'>
        <p>All content copyright Steve Tooke &copy; 2014 &middot; All rights reserved.</p>
        <p>Find me on <a href="http://twitter.com/tooky">Twitter</a> | <a href="https://plus.google.com/+SteveTooke-Heavies/">Google+</a></a></p>
    </div>
    </footer>
  </div>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-37664795-2', 'tooky.co.uk');
    ga('send', 'pageview');

  </script>
  </body>
</html>
